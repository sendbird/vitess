# DO NOT MODIFY: THIS FILE IS GENERATED USING "make generate_ci_workflows"

env:
  GOROOT: "/usr/local/go"
  PATH: "/usr/local/go/bin:$PATH"
steps:
  - label: "Unit Test (mysql57)"
    commands:
        # Set up Go
        - ./.buildkite/setup_go.sh
        # Tune the OS
        - echo '1024 65535' | sudo tee -a /proc/sys/net/ipv4/ip_local_port_range
        # Get dependencies
        - export DEBIAN_FRONTEND="noninteractive"
        - sudo apt-get update
        
        # !mysql80
        # Uninstall any previously installed MySQL first
        - ./.buildkite/uninstall_mysql.sh
        
        # mysql57
        - ./.buildkite/install_mysql57.sh
        
        - ./.buildkite/install_dependencies.sh
        # Run make tools
        - make tools
        # Run test
        - eatmydata -- make unit_test
    timeout_in_minutes: 30
  - label: "Unit Test (mysql80)"
    commands:
        # Set up Go
        - ./.buildkite/setup_go.sh
        # Tune the OS
        - echo '1024 65535' | sudo tee -a /proc/sys/net/ipv4/ip_local_port_range
        # Get dependencies
        - export DEBIAN_FRONTEND="noninteractive"
        - sudo apt-get update
        
        # mysql80
        - sudo apt-get install -y mysql-server mysql-client
         
        - ./.buildkite/install_dependencies.sh
        # Run make tools
        - make tools
        # Run test
        - eatmydata -- make unit_test
    timeout_in_minutes: 30
